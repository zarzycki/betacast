# atm_to_cam

### Command line options for atm_to_cam.ncl

| Namelist Variable | Type | Description | Default |
| --- | --- | --- | --- | --- | --- |
| datasource | Str | CFSR, ERA5, ERAI, GFS, CAM, RAP | |
| numlevels | Int | Number of levels | |
| YYYYMMDDHH | Int | Initialization date | |
| dycore | Str | fv, se, mpas | |
| RDADIR | Str | Base path to RDA folder if on Cheyenne | |
| data_filename | Str | Full path to file containing initial information | |
| wgt_filename | Str | Full path to ESMF weight file from ANL -> MOD | |
| mpas_as_cam | Bool | If true, write MPAS in CAM physics output (ncol, for nudging), if false write MPAS in MPAS-A format (nCells, for init) | |
| compress_file | Bool | If true, will attempt NetCDF "chunking" compression within NCL | |
| add_cloud_vars | Bool | If true, add CLDICE and CLDLIQ to output file | |
| adjust_config | String | String defining how to perform hydro adjustment: if string is not empty, will do config. If "a" also try and correct TBOT in addition to PS | |
| model_topo_file | String | If MPAS, an MPAS inic file, otherwise a file containing PHIS for FV or SE | |
| se_inic | String | Full path of file to write as output | |
| mod_in_topo | Str | Full path to PHIS field from *downscaling* MOD for pressure surface calculation purposes | |
| mod_remap_file | Str | Full path to ESMF weight file that goes *downscaling* MOD -> ANL | |


### Some notes:

#### Downscaling CAM data

For downscaling CAM data one must pass in:

- mod_in_topo
- mod_remap_file

`mod_remap_file` should be an ESMF file going from the CAM input data to the analysis grid of interest (unless the forcing data is high-res, using the ERA5 0.25deg grid seems to be safest -- e.g., ne120 -> 0.25x0.25). `mod_in_topo` should be the path to the bnd_topo file containing PHIS for the downscaling model grid (e.g., ne120).

`data_filename` must contain a snapshot of 3-D U, V, T, Q, and 2-D PS. The requested `YYYYMMDDHH` must lie within the bounds of the time dimension in `data_filename`.

#### MPAS data

For MPAS data, the input variable `model_topo_file` actually contains the full initial condition file generated by MPAS's `init_atmosphere` routine. If one sets `mpas_as_cam` to False, `model_topo_file` will be copied to `se_inic` and then the state fields overwritten by the script so that the `se_inic` file can be passed in as an `ncdata` file.

#### Hydrostatic adjustment

Currently the hydrostatic adjustment is only available when `dycore` is set to SE. The code is activated if a valid `model_topo_file` containing `PHIS` is passed in and `adjust_config` is not an empty string. If `adjust_config=a` that applies a special case where both PS and TBOT are adjusted. Otherwise, only PS is adjusted. All state fields are then reinterpolated based on the new hybrid pressure levels associated with the updated PS.

#### Using RDA data

On Cheyenne (and when mirrored on other systems) Betacast can go directly to RDA to get ERA5 data. To do this, point `RDADIR` to the datasets top-level directory (e.g., /glade/collections/rda/data/ds633.0/). In this case, this file will be used if the hydrostatic adjustment code is active where `data_filename` is the invariant field containing the surface Z field (e.g., ${RDADIR}/e5.oper.invariant/197901/e5.oper.invariant.128_129_z.ll025sc.1979010100_1979010100.nc).
